# TODO(dio): Consider to remove compiler specific part of this patch when we solely compile the
# project using clang-cl. Tracked in https://github.com/envoyproxy/envoy/issues/11974.

diff --git a/base/compiler_specific.h b/base/compiler_specific.h
index 0174b6d..fb5b80d 100644
--- a/base/compiler_specific.h
+++ b/base/compiler_specific.h
@@ -7,10 +7,6 @@
 
 #include "build/build_config.h"
 
-#if defined(COMPILER_MSVC) && !defined(__clang__)
-#error "Only clang-cl is supported on Windows, see https://crbug.com/988071"
-#endif
-
 // A wrapper around `__has_attribute()`, which is similar to the C++20-standard
 // `__has_cpp_attribute()`, but tests for support for `__attribute__(())`s.
 // Compilers that do not support this (e.g. MSVC) are also assumed not to
diff --git a/base/numerics/clamped_math_impl.h b/base/numerics/clamped_math_impl.h
index 10023f0..783f5da 100644
--- a/base/numerics/clamped_math_impl.h
+++ b/base/numerics/clamped_math_impl.h
@@ -31,6 +31,7 @@
 template <typename T>
   requires(std::unsigned_integral<T>)
 constexpr T SaturatedNegWrapper(T value) {
+  (void)value; // unused
   return T(0);
 }

diff --git a/build_config/BUILD b/build_config/BUILD
index 78ac01d..eeef238 100644
--- a/build_config/BUILD
+++ b/build_config/BUILD
@@ -5,11 +5,13 @@
 config_setting(
     name = "windows_x86_64",
     values = {"cpu": "x64_windows"},
+    visibility = ["//visibility:public"],
 )

 bool_flag(
     name = "system_icu",
     build_setting_default = True,
+    visibility = ["//visibility:public"],
 )

 config_setting(
@@ -17,4 +19,5 @@
     flag_values = {
         ":system_icu": "True",
     },
+    visibility = ["//visibility:public"],
 )
diff --git a/base/containers/span.h b/base/containers/span.h
index 0000000..1111111 100644
--- a/base/containers/span.h
+++ b/base/containers/span.h
@@ -5,6 +5,14 @@
 #ifndef BASE_CONTAINERS_SPAN_H_
 #define BASE_CONTAINERS_SPAN_H_
 
+// Workaround for libc++ not having std::lexicographical_compare_three_way yet.
+// This forces the code to use the fallback comparison operators defined below.
+// This workaround is scoped to only this header file.
+// See: https://github.com/llvm/llvm-project/issues/92840
+#if defined(_LIBCPP_VERSION)
+#if defined(__cpp_lib_three_way_comparison)
+#undef __cpp_lib_three_way_comparison
+#endif
+#endif
+
 #include <stddef.h>
 #include <stdint.h>
 
diff --git a/polyfills/third_party/perfetto/include/perfetto/tracing/traced_value.h b/polyfills/third_party/perfetto/include/perfetto/tracing/traced_value.h
index 0000000..1111111 100644
--- a/polyfills/third_party/perfetto/include/perfetto/tracing/traced_value.h
+++ b/polyfills/third_party/perfetto/include/perfetto/tracing/traced_value.h
@@ -13,7 +13,8 @@
 // Polyfill for perfetto traced values.
 namespace perfetto {
 class EventContext;
-void WriteIntoTracedValue(TracedValue context, int32_t value) {}
+void WriteIntoTracedValue([[maybe_unused]] TracedValue context,
+                          [[maybe_unused]] int32_t value) {}
 }  // namespace perfetto
 
 #endif  // GOOGLEURL_POLYFILLS_THIRD_PARTY_PERFETTO_INCLUDE_PERFETTO_TRACING_TRACED_VALUE_H_
